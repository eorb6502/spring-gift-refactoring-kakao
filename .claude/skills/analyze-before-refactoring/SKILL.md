---
name: analyze-before-refactoring
description: 코드를 리팩토링하기 전에 주석, TODO, git blame을 분석하여 변경 근거를 확인하고 결과를 MD 파일로 생성합니다.
disable-model-invocation: true
allowed-tools: Bash(git:*), Read, Grep, Glob, Write
argument-hint: [분석 대상 설명 (예: "미사용 @Autowired", "Validator 중복 코드")]
---

# Analyze Before Refactoring

코드를 리팩토링하기 전에, 변경 근거를 확인하고 분석 보고서를 MD 파일로 생성한다.

## 1단계: 분석 대상 파일 탐색

`$ARGUMENTS`에 해당하는 코드를 프로젝트에서 찾는다.

- Grep과 Glob을 사용하여 대상 코드가 포함된 파일과 라인을 모두 찾는다.
- 해당 코드가 실제로 사용되는 곳이 있는지도 함께 확인한다 (import, 호출부, 참조 등).

## 2단계: 주석 및 TODO 분석

대상 코드 주변(위아래 10줄 이내)에 다음이 있는지 확인한다:

- `// TODO`, `// FIXME`, `// HACK`, `// NOTE`, `// XXX` 등의 주석
- 해당 코드의 존재 이유를 설명하는 일반 주석
- Javadoc이나 설명 문서

각 항목에 대해 아래를 기록한다:

| 항목 | 내용 |
|------|------|
| 파일:라인 | 주석이 위치한 정확한 위치 |
| 주석 내용 | 원문 그대로 |
| 의도 분석 | 이 주석이 코드 존재를 정당화하는지 여부 |

## 3단계: Git Blame 분석

대상 코드의 각 라인에 대해 git blame을 실행한다.

```bash
git blame -L <시작줄>,<끝줄> <파일경로>
```

각 대상에 대해 아래를 기록한다:

| 항목 | 내용 |
|------|------|
| 파일:라인 | 코드 위치 |
| 작성자 | git blame에서 확인한 커밋 작성자 |
| 커밋 해시 | 해당 라인의 마지막 수정 커밋 |
| 커밋 메시지 | 왜 추가/수정되었는지 |
| 커밋 날짜 | 언제 추가되었는지 |

커밋 메시지가 부족하면 해당 커밋의 전체 diff도 확인한다:

```bash
git show <커밋해시> --stat
```

## 4단계: 리팩토링 영향도 분석

아래 3가지 관점에서 리팩토링 가능 여부를 판단한다.

### 4-1. 주석/TODO에 의도가 있는가

- 주석에 "나중에 사용", "향후 확장", "임시" 등의 표현이 있으면 리팩토링 보류 권장.
- 의도를 설명하는 주석이 없으면 리팩토링 근거가 강화된다.

### 4-2. git blame으로 누가 왜 추가했는가

- 최근 커밋(1개월 이내)이면 의도적 추가일 가능성이 높으므로 주의.
- 초기 설정 커밋에 포함된 코드는 템플릿/보일러플레이트일 가능성이 높다.
- 커밋 메시지에 명확한 의도가 있으면 리팩토링 전 재확인 필요.

### 4-3. 이후 단계(작동 변경)와 충돌하지 않는가

- README.md의 구현 목록을 확인하여, 리팩토링 대상이 이후 작업에서 필요한 코드인지 판단한다.
- 다른 브랜치나 PR에서 해당 코드를 참조하는지 확인한다.

## 5단계: 보고서 생성

분석 결과를 아래 형식으로 `docs/refactoring-analysis-<대상요약>.md` 파일에 저장한다.

파일을 생성하기 전에 `docs/` 디렉토리가 없으면 먼저 생성한다.

### 보고서 템플릿

```markdown
# 리팩토링 분석 보고서: <대상 설명>

> 분석 일시: <현재 날짜>

## 분석 대상

- 설명: <무엇을 리팩토링하려는지>
- 관련 파일: <파일 목록>

## 1. 대상 코드 현황

| # | 파일 | 라인 | 코드 내용 | 사용 여부 |
|---|------|------|-----------|-----------|
| 1 | ... | ... | ... | 미사용/사용중 |

## 2. 주석 및 TODO 분석

| # | 파일:라인 | 주석 내용 | 리팩토링에 영향 |
|---|-----------|-----------|-----------------|
| 1 | ... | ... | 없음/있음(사유) |

> 주석이 없는 경우: "대상 코드 주변에 의도를 설명하는 주석이 없습니다."

## 3. Git Blame 분석

| # | 파일:라인 | 작성자 | 커밋 | 날짜 | 커밋 메시지 |
|---|-----------|--------|------|------|-------------|
| 1 | ... | ... | ... | ... | ... |

### 커밋 상세

각 커밋에 대한 추가 분석이 필요한 경우 여기에 기술한다.

## 4. 리팩토링 영향도 판단

### 주석/TODO 의도 확인
- [ ] 의도를 설명하는 주석 없음
- [ ] TODO/FIXME 없음

### Git 이력 확인
- [ ] 초기 설정 또는 템플릿 코드로 판단됨
- [ ] 커밋 메시지에 리팩토링을 막을 만한 의도 없음

### 이후 단계 충돌 확인
- [ ] README.md 구현 목록과 충돌 없음
- [ ] 향후 작업에서 필요하지 않음

## 5. 최종 판단

| 대상 | 판단 | 근거 요약 |
|------|------|-----------|
| ... | 리팩토링 가능 / 리팩토링 보류 / 추가 확인 필요 | ... |

## 6. 권장 작업 순서

리팩토링 가능으로 판단된 항목의 작업 순서를 제안한다.

1. ...
2. ...
```

## 주의사항

- 코드를 직접 수정하거나 삭제하지 않는다. 분석 보고서 생성만 수행한다.
- 판단이 애매한 경우 "추가 확인 필요"로 표기하고, 확인 방법을 제안한다.
- git blame 결과가 initial commit인 경우, 프로젝트 템플릿에서 온 코드일 가능성을 명시한다.
- 보고서 파일명에 한글이 포함되지 않도록 영문 요약을 사용한다.

$ARGUMENTS
